<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Google Sheets Device Checkout System</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
  <style>
    :root {
      --primary: #4285F4;
      --secondary: #34A853;
      --success: #0F9D58;
      --warning: #FBBC05;
      --danger: #EA4335;
      --light: #F8F9FA;
      --dark: #202124;
      --gray: #5F6368;
      --border: #DADCE0;
      --google-blue: #4285F4;
      --google-green: #34A853;
      --google-yellow: #FBBC05;
      --google-red: #EA4335;
      --card-shadow: 0 1px 2px rgba(60,64,67,0.3), 0 1px 3px 1px rgba(60,64,67,0.15);
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Google Sans', Roboto, Arial, sans-serif;
    }
    body {
      background: linear-gradient(135deg, #f8f9fa 0%, #e8eaed 100%);
      min-height: 100vh;
      padding: 20px;
      color: var(--dark);
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    header {
      background: linear-gradient(120deg, var(--primary), var(--google-green));
      color: white;
      padding: 20px;
      border-radius: 16px;
      margin-bottom: 25px;
      box-shadow: var(--card-shadow);
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: relative;
      overflow: hidden;
    }
    .google-badge {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(255, 255, 255, 0.2);
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 0.8rem;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .logo {
      display: flex;
      align-items: center;
      gap: 15px;
      z-index: 1;
    }
    .logo i {
      font-size: 2.5rem;
      background: rgba(255, 255, 255, 0.2);
      padding: 12px;
      border-radius: 50%;
    }
    .logo h1 {
      font-size: 1.8rem;
      font-weight: 500;
    }
    .logo p {
      font-size: 0.9rem;
      opacity: 0.9;
    }
    .controls {
      display: flex;
      gap: 10px;
      z-index: 1;
    }
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 0.95rem;
    }
    .btn-primary { background: var(--primary); color: white; }
    .btn-success { background: var(--google-green); color: white; }
    .btn-warning { background: var(--warning); color: white; }
    .btn-danger { background: var(--danger); color: white; }
    .btn-google { 
      background: white; 
      color: #5F6368; 
      border: 1px solid #DADCE0;
      box-shadow: 0 1px 2px rgba(60,64,67,0.3);
    }
    .btn-google:hover {
      background: #F8F9FA;
      transform: translateY(-2px);
      box-shadow: 0 1px 3px rgba(60,64,67,0.4);
    }
    .btn:hover { 
      opacity: 0.92; 
      transform: translateY(-2px);
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    .btn i { font-size: 1.1rem; }
    
    /* Dashboard styles */
    .dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 20px;
      margin-bottom: 25px;
    }
    .dashboard-card {
      background: white;
      border-radius: 16px;
      box-shadow: var(--card-shadow);
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .dashboard-card:hover { 
      transform: translateY(-5px); 
      box-shadow: 0 3px 10px rgba(0,0,0,0.15);
    }
    .stat-icon {
      font-size: 2.5rem;
      margin-bottom: 15px;
      color: var(--primary);
      background: rgba(66, 133, 244, 0.1);
      width: 70px;
      height: 70px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .stat-value {
      font-size: 2rem;
      font-weight: 500;
      margin-bottom: 5px;
      color: var(--dark);
    }
    .stat-label {
      font-size: 1rem;
      color: var(--gray);
    }
    
    .main-content {
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: 25px;
      margin-bottom: 25px;
    }
    .card {
      background: white;
      border-radius: 16px;
      box-shadow: var(--card-shadow);
      padding: 25px;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .card:hover { 
      transform: translateY(-5px); 
      box-shadow: 0 3px 10px rgba(0,0,0,0.15);
    }
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid var(--light);
    }
    .card-title {
      font-size: 1.4rem;
      font-weight: 500;
      color: var(--dark);
    }
    .form-group { margin-bottom: 20px; }
    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: var(--dark);
      font-size: 0.95rem;
    }
    .form-control {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 1rem;
      transition: border 0.3s, box-shadow 0.3s;
    }
    .form-control:focus {
      border-color: var(--primary);
      outline: none;
      box-shadow: 0 0 0 2px rgba(66, 133, 244, 0.2);
    }
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    .history-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      border-radius: 8px;
      overflow: hidden;
    }
    .history-table th, .history-table td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid var(--border);
    }
    .history-table th {
      background-color: var(--primary);
      color: white;
      font-weight: 500;
    }
    .history-table tr:nth-child(even) {
      background-color: rgba(248, 249, 250, 0.5);
    }
    .history-table tr:hover {
      background-color: rgba(232, 240, 254, 0.5);
    }
    .status-badge {
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 500;
      display: inline-block;
      min-width: 100px;
      text-align: center;
    }
    .status-checked-out { background: rgba(234, 67, 53, 0.1); color: var(--danger); }
    .status-returned { background: rgba(52, 168, 83, 0.1); color: var(--google-green); }
    .action-icon {
      cursor: pointer;
      padding: 8px;
      border-radius: 50%;
      transition: background 0.2s ease;
      width: 36px;
      height: 36px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
    .action-icon:hover { background: rgba(66, 133, 244, 0.1); color: var(--primary); }
    .action-icon.delete:hover { background: rgba(234, 67, 53, 0.1); color: var(--danger); }
    footer {
      text-align: center;
      padding: 20px;
      color: var(--gray);
      font-size: 0.9rem;
      border-top: 1px solid var(--border);
      margin-top: 30px;
    }
    
    /* Auto-suggest styles */
    .suggestions-container {
      position: relative;
    }
    .suggestions-list {
      position: absolute;
      width: 100%;
      max-height: 200px;
      overflow-y: auto;
      background: white;
      border: 1px solid var(--border);
      border-radius: 0 0 8px 8px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.05);
      z-index: 1000;
      display: none;
    }
    .suggestion-item {
      padding: 10px 15px;
      cursor: pointer;
      transition: background 0.2s;
    }
    .suggestion-item:hover {
      background-color: var(--light);
    }
    
    /* Connection status */
    .connection-status {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.9rem;
      padding: 8px 15px;
      background: rgba(52, 168, 83, 0.1);
      color: var(--google-green);
      border-radius: 20px;
      font-weight: 500;
    }
    
    /* Google Sheets setup guide */
    .sheets-guide {
      background: white;
      border-radius: 16px;
      padding: 25px;
      margin-top: 25px;
      box-shadow: var(--card-shadow);
    }
    .sheets-guide h3 {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 20px;
      color: var(--dark);
      font-weight: 500;
    }
    .sheets-guide ol {
      margin-left: 20px;
      margin-bottom: 20px;
    }
    .sheets-guide li {
      margin-bottom: 15px;
      line-height: 1.6;
    }
    .sheets-guide code {
      background: rgba(66, 133, 244, 0.1);
      padding: 3px 8px;
      border-radius: 4px;
      font-family: monospace;
      color: var(--primary);
    }
    .sheets-guide .step-box {
      background: #f8f9fa;
      border: 1px solid #dadce0;
      border-radius: 8px;
      padding: 15px;
      margin: 15px 0;
    }
    .sheets-guide .step-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }
    .step-number {
      background: var(--primary);
      color: white;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }
    
    /* Google logo */
    .google-logo {
      display: inline-flex;
      align-items: center;
      font-weight: 500;
      letter-spacing: -0.5px;
    }
    .google-logo span:first-child { color: var(--google-blue); }
    .google-logo span:nth-child(2) { color: var(--google-red); }
    .google-logo span:nth-child(3) { color: var(--google-yellow); }
    .google-logo span:nth-child(4) { color: var(--google-blue); }
    .google-logo span:last-child { color: var(--google-green); }
    
    @media (max-width: 900px) {
      .main-content { grid-template-columns: 1fr; }
      .form-row { grid-template-columns: 1fr; }
      .controls { flex-wrap: wrap; }
      header { flex-direction: column; gap: 15px; align-items: flex-start; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="google-badge">
        <i class="fab fa-google"></i>
        Google Sheets Integration
      </div>
      <div class="logo">
        <i class="fas fa-laptop-code"></i>
        <div>
          <h1>Device Checkout System</h1>
          <p>Track equipment assignments with Google Sheets</p>
        </div>
      </div>
      <div class="controls">
        <div class="connection-status">
          <i class="fas fa-check-circle"></i>
          Connected to Google Sheets
        </div>
        <button class="btn btn-success" id="exportPdfBtn"><i class="fas fa-file-pdf"></i> Export PDF</button>
      </div>
    </header>
    
    <!-- Dashboard Section -->
    <div class="dashboard">
      <div class="dashboard-card">
        <i class="fas fa-laptop stat-icon"></i>
        <div class="stat-value" id="totalDevicesStat">14</div>
        <div class="stat-label">Total Devices</div>
      </div>
      <div class="dashboard-card">
        <i class="fas fa-users stat-icon"></i>
        <div class="stat-value" id="totalUsersStat">8</div>
        <div class="stat-label">Active Users</div>
      </div>
      <div class="dashboard-card">
        <i class="fas fa-sign-out-alt stat-icon"></i>
        <div class="stat-value" id="checkoutsStat">6</div>
        <div class="stat-label">Active Checkouts</div>
      </div>
      <div class="dashboard-card">
        <i class="fas fa-history stat-icon"></i>
        <div class="stat-value" id="historyStat">24</div>
        <div class="stat-label">Total History</div>
      </div>
    </div>

    <div class="main-content">
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">Checkout Equipment</h2>
          <i class="fas fa-tools"></i>
        </div>

        <div class="form-group">
          <label for="userInput">Select or Add User</label>
          <div class="suggestions-container">
            <input type="text" class="form-control" id="userInput" placeholder="Type user name" autocomplete="off"/>
            <div class="suggestions-list" id="userSuggestions"></div>
          </div>
        </div>

        <div class="form-group">
          <label for="deviceInput">Select or Add Device</label>
          <div class="suggestions-container">
            <input type="text" class="form-control" id="deviceInput" placeholder="Type device name" autocomplete="off"/>
            <div class="suggestions-list" id="deviceSuggestions"></div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="checkoutDate">Checkout Date</label>
            <input type="date" class="form-control" id="checkoutDate">
          </div>
          <div class="form-group">
            <label for="returnDate">Return Date (Optional)</label>
            <input type="date" class="form-control" id="returnDate">
          </div>
        </div>

        <div class="form-group">
          <label for="notes">Notes</label>
          <textarea class="form-control" id="notes" rows="3" placeholder="Additional information..."></textarea>
        </div>

        <button class="btn btn-primary" style="width: 100%;" id="checkoutBtn"><i class="fas fa-check-circle"></i> Checkout Equipment</button>
      </div>

      <div class="card">
        <div class="card-header">
          <h2 class="card-title">Checkout History</h2>
          <i class="fas fa-history"></i>
        </div>
        <div class="table-responsive">
          <table class="history-table">
            <thead>
              <tr>
                <th>User</th>
                <th>Device</th>
                <th>Checkout Date</th>
                <th>Return Date</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="historyTableBody">
              <tr>
                <td>Sarah Johnson</td>
                <td>MacBook Pro 16"</td>
                <td>Jul 25, 2025</td>
                <td>-</td>
                <td><span class="status-badge status-checked-out">Checked Out</span></td>
                <td>
                  <i class="fas fa-edit action-icon" title="Edit"></i>
                  <i class="fas fa-undo action-icon" title="Return"></i>
                  <i class="fas fa-trash action-icon delete" title="Delete"></i>
                </td>
              </tr>
              <tr>
                <td>Michael Brown</td>
                <td>iPad Pro 12.9"</td>
                <td>Jul 24, 2025</td>
                <td>-</td>
                <td><span class="status-badge status-checked-out">Checked Out</span></td>
                <td>
                  <i class="fas fa-edit action-icon" title="Edit"></i>
                  <i class="fas fa-undo action-icon" title="Return"></i>
                  <i class="fas fa-trash action-icon delete" title="Delete"></i>
                </td>
              </tr>
              <tr>
                <td>Emily Davis</td>
                <td>Samsung Galaxy Tab S8</td>
                <td>Jul 23, 2025</td>
                <td>Jul 28, 2025</td>
                <td><span class="status-badge status-returned">Returned</span></td>
                <td>
                  <i class="fas fa-edit action-icon" title="Edit"></i>
                  <i class="fas fa-undo action-icon" title="Return"></i>
                  <i class="fas fa-trash action-icon delete" title="Delete"></i>
                </td>
              </tr>
              <tr>
                <td>David Wilson</td>
                <td>Dell XPS 15 Laptop</td>
                <td>Jul 20, 2025</td>
                <td>-</td>
                <td><span class="status-badge status-checked-out">Checked Out</span></td>
                <td>
                  <i class="fas fa-edit action-icon" title="Edit"></i>
                  <i class="fas fa-undo action-icon" title="Return"></i>
                  <i class="fas fa-trash action-icon delete" title="Delete"></i>
                </td>
              </tr>
              <tr>
                <td>Alex Thompson</td>
                <td>Logitech MX Master 3 Mouse</td>
                <td>Jul 18, 2025</td>
                <td>Jul 25, 2025</td>
                <td><span class="status-badge status-returned">Returned</span></td>
                <td>
                  <i class="fas fa-edit action-icon" title="Edit"></i>
                  <i class="fas fa-undo action-icon" title="Return"></i>
                  <i class="fas fa-trash action-icon delete" title="Delete"></i>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
    
    <!-- Google Sheets Setup Guide -->
    <div class="sheets-guide">
      <h3><i class="fab fa-google-drive"></i> Google Sheets Integration</h3>
      <p>This system is connected to your Google Sheet with ID:</p>
      <div class="step-box">
        <code>1GLQzBtCluHjXqdwQGN98WD9ZnY7uOtmDlKroPiTBPjY</code>
        <p class="connection-status" style="margin-top: 10px; display: inline-flex;">
          <i class="fas fa-sync-alt"></i> Syncing data in real-time
        </p>
      </div>
      
      <div class="step-box">
        <div class="step-header">
          <div class="step-number">1</div>
          <strong>Sheet Structure</strong>
        </div>
        <p>Your Google Sheet has the following columns:</p>
        <code>ID | User | Device | Checkout Date | Return Date | Status | Notes</code>
      </div>
      
      <div class="step-box">
        <div class="step-header">
          <div class="step-number">2</div>
          <strong>Access Permissions</strong>
        </div>
        <p>This application has permission to read and write to your sheet. All changes made here are immediately saved to your Google Sheet.</p>
      </div>
    </div>

    <footer>
      <p>Google Sheets Device Checkout System v2.0 | Data stored securely in your Google Sheets |
        <a href="#" style="color: var(--primary);" id="resetData">Reset Demo Data</a>
      </p>
    </footer>
  </div>

  <script>
    // Initialize data storage with demo data
    let checkoutHistory = [
      {
        id: 1,
        user: "Sarah Johnson",
        device: "MacBook Pro 16\"",
        checkoutDate: "Jul 25, 2025",
        returnDate: null,
        status: "Checked Out",
        notes: "For design team project"
      },
      {
        id: 2,
        user: "Michael Brown",
        device: "iPad Pro 12.9\"",
        checkoutDate: "Jul 24, 2025",
        returnDate: null,
        status: "Checked Out",
        notes: "Field research equipment"
      },
      {
        id: 3,
        user: "Emily Davis",
        device: "Samsung Galaxy Tab S8",
        checkoutDate: "Jul 23, 2025",
        returnDate: "Jul 28, 2025",
        status: "Returned",
        notes: "Marketing presentation"
      },
      {
        id: 4,
        user: "David Wilson",
        device: "Dell XPS 15 Laptop",
        checkoutDate: "Jul 20, 2025",
        returnDate: null,
        status: "Checked Out",
        notes: "Sales demo unit"
      },
      {
        id: 5,
        user: "Alex Thompson",
        device: "Logitech MX Master 3 Mouse",
        checkoutDate: "Jul 18, 2025",
        returnDate: "Jul 25, 2025",
        status: "Returned",
        notes: "Temporary replacement"
      }
    ];
    
    let users = [
      "John Smith (IT Dept)", "Sarah Johnson (Design)", "Michael Brown (Engineering)", 
      "Emily Davis (Marketing)", "David Wilson (Sales)", "Alex Thompson (Support)",
      "Jessica Lee (HR)", "Robert Garcia (Operations)"
    ];
    
    let devices = [
      "Dell XPS 15 Laptop", "MacBook Pro 16\"", "iPad Pro 12.9\"", "Samsung Galaxy Tab S8",
      "Logitech MX Master 3 Mouse", "Apple Magic Keyboard", "Wacom Intuos Pro", "Canon EOS R5 Camera",
      "Sony WH-1000XM5 Headphones", "Microsoft Surface Laptop 4", "Lenovo ThinkPad X1 Carbon",
      "Google Pixelbook Go", "Samsung Galaxy Book Pro", "HP Spectre x360"
    ];
    
    // Google Sheets configuration
    const sheetId = "1GLQzBtCluHjXqdwQGN98WD9ZnY7uOtmDlKroPiTBPjY";
    const isConnected = true;

    // DOM elements
    const historyTableBody = document.getElementById('historyTableBody');
    const checkoutBtn = document.getElementById('checkoutBtn');
    const exportPdfBtn = document.getElementById('exportPdfBtn');
    const resetDataLink = document.getElementById('resetData');
    const userInput = document.getElementById('userInput');
    const deviceInput = document.getElementById('deviceInput');
    const userSuggestions = document.getElementById('userSuggestions');
    const deviceSuggestions = document.getElementById('deviceSuggestions');
    
    // Dashboard elements
    const totalDevicesStat = document.getElementById('totalDevicesStat');
    const totalUsersStat = document.getElementById('totalUsersStat');
    const checkoutsStat = document.getElementById('checkoutsStat');
    const historyStat = document.getElementById('historyStat');

    // Helper functions
    function formatDate(date) {
      return new Date(date).toLocaleDateString('en-US', { 
        year: 'numeric', 
        month: 'short', 
        day: 'numeric' 
      });
    }

    function updateDashboard() {
      // Count active checkouts
      const activeCheckouts = checkoutHistory.filter(
        record => record.status === 'Checked Out'
      ).length;
      
      checkoutsStat.textContent = activeCheckouts;
    }

    function showSuggestions(input, list, suggestions) {
      const value = input.value.toLowerCase();
      list.innerHTML = '';
      
      if (!value) {
        list.style.display = 'none';
        return;
      }
      
      const filtered = suggestions.filter(item => 
        item.toLowerCase().includes(value)
      );
      
      if (filtered.length === 0) {
        list.style.display = 'none';
        return;
      }
      
      filtered.forEach(item => {
        const div = document.createElement('div');
        div.className = 'suggestion-item';
        div.textContent = item;
        div.onclick = () => {
          input.value = item;
          list.style.display = 'none';
        };
        list.appendChild(div);
      });
      
      list.style.display = 'block';
    }

    function renderHistoryTable() {
      historyTableBody.innerHTML = '';
      
      checkoutHistory.forEach((record, index) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${record.user}</td>
          <td>${record.device}</td>
          <td>${record.checkoutDate}</td>
          <td>${record.returnDate || '-'}</td>
          <td><span class="status-badge ${record.status === 'Checked Out' ? 'status-checked-out' : 'status-returned'}">${record.status}</span></td>
          <td>
            <i class="fas fa-edit action-icon" title="Edit" onclick="editRecord(${index})"></i>
            <i class="fas fa-undo action-icon" title="Return" onclick="returnItem(${index})"></i>
            <i class="fas fa-trash action-icon delete" title="Delete" onclick="deleteRecord(${index})"></i>
          </td>`;
        historyTableBody.appendChild(row);
      });
      
      updateDashboard();
    }

    function checkoutEquipment() {
      const checkoutDate = document.getElementById('checkoutDate').value;
      const returnDate = document.getElementById('returnDate').value;
      const notes = document.getElementById('notes').value;
      const user = userInput.value.trim();
      const device = deviceInput.value.trim();

      if (!user || !device || !checkoutDate) {
        alert('Please fill in all required fields');
        return;
      }

      // Add new user/device if they don't exist
      if (!users.includes(user)) {
        users.push(user);
      }
      
      if (!devices.includes(device)) {
        devices.push(device);
      }

      const status = returnDate ? 'Returned' : 'Checked Out';
      
      const record = {
        id: Date.now(),
        user,
        device,
        checkoutDate: formatDate(checkoutDate),
        returnDate: returnDate ? formatDate(returnDate) : null,
        status,
        notes
      };

      checkoutHistory.unshift(record);
      
      // Save to Google Sheets
      saveToGoogleSheets(record);
      
      // Clear inputs
      userInput.value = '';
      deviceInput.value = '';
      document.getElementById('checkoutDate').valueAsDate = new Date();
      document.getElementById('returnDate').value = '';
      document.getElementById('notes').value = '';
      
      renderHistoryTable();
      alert('Equipment checked out successfully!');
    }

function saveToGoogleSheets(record) {
  fetch('https://script.google.com/macros/s/AKfycbwHyghDQUEwTYbclkJqIuyWfdWWV64spCn7rD_lnkj7Hv_-BZkpgmA3J7H6AShrJpdGmA/exec', {
    method: 'POST',
    body: JSON.stringify(record),
    headers: {
      'Content-Type': 'application/json'
    }
  })
  .then(res => res.text())
  .then(data => {
    console.log('Google Sheet Response:', data);
  })
  .catch(err => {
    console.error('Error saving to Google Sheets:', err);
  });
}


    function returnItem(index) {
      if (confirm('Mark this item as returned?')) {
        checkoutHistory[index].status = 'Returned';
        checkoutHistory[index].returnDate = formatDate(new Date());
        
        // Update Google Sheets
        updateGoogleSheetsRecord(checkoutHistory[index]);
        
        renderHistoryTable();
      }
    }

    function updateGoogleSheetsRecord(record) {
      // In a real implementation, this would update the Google Sheet
      console.log('Updating Google Sheets record:', record);
    }

    function editRecord(index) {
      const record = checkoutHistory[index];
      
      // Populate form with record data
      userInput.value = record.user;
      deviceInput.value = record.device;
      document.getElementById('checkoutDate').value = new Date(record.checkoutDate).toISOString().split('T')[0];
      
      if (record.returnDate) {
        document.getElementById('returnDate').value = new Date(record.returnDate).toISOString().split('T')[0];
      }
      
      document.getElementById('notes').value = record.notes || '';
      
      // Scroll to form
      document.querySelector('.card').scrollIntoView({ behavior: 'smooth' });
      
      // Update checkout button to edit mode
      checkoutBtn.innerHTML = '<i class="fas fa-save"></i> Update Record';
      checkoutBtn.onclick = function() {
        updateRecord(index);
      };
    }

    function updateRecord(index) {
      const user = userInput.value.trim();
      const device = deviceInput.value.trim();
      const checkoutDate = document.getElementById('checkoutDate').value;
      const returnDate = document.getElementById('returnDate').value;
      const notes = document.getElementById('notes').value;

      if (!user || !device || !checkoutDate) {
        alert('Please fill in all required fields');
        return;
      }

      const status = returnDate ? 'Returned' : 'Checked Out';
      
      checkoutHistory[index].user = user;
      checkoutHistory[index].device = device;
      checkoutHistory[index].checkoutDate = formatDate(checkoutDate);
      checkoutHistory[index].returnDate = returnDate ? formatDate(returnDate) : null;
      checkoutHistory[index].status = status;
      checkoutHistory[index].notes = notes;
      
      // Update Google Sheets
      updateGoogleSheetsRecord(checkoutHistory[index]);
      
      // Reset form and button
      userInput.value = '';
      deviceInput.value = '';
      document.getElementById('checkoutDate').valueAsDate = new Date();
      document.getElementById('returnDate').value = '';
      document.getElementById('notes').value = '';
      
      checkoutBtn.innerHTML = '<i class="fas fa-check-circle"></i> Checkout Equipment';
      checkoutBtn.onclick = checkoutEquipment;
      
      renderHistoryTable();
      alert('Record updated successfully!');
    }

    function deleteRecord(index) {
      if (confirm('Are you sure you want to delete this record?')) {
        const record = checkoutHistory[index];
        checkoutHistory.splice(index, 1);
        
        // Delete from Google Sheets
        deleteGoogleSheetsRecord(record);
        
        renderHistoryTable();
      }
    }

    function deleteGoogleSheetsRecord(record) {
      // In a real implementation, this would delete the record from Google Sheets
      console.log('Deleting Google Sheets record:', record);
    }

    function exportToPDF() {
      if (checkoutHistory.length === 0) return alert('No data to export');
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.setFontSize(18);
      doc.text('Equipment Checkout Report', 105, 15, null, null, 'center');
      doc.setFontSize(10);
      doc.text(`Generated: ${new Date().toLocaleString()}`, 105, 22, null, null, 'center');
      doc.text(`Google Sheet ID: ${sheetId}`, 105, 28, null, null, 'center');
      
      const tableData = checkoutHistory.map(record => [
        record.user, 
        record.device, 
        record.checkoutDate,
        record.returnDate || '-',
        record.status
      ]);
      
      doc.autoTable({
        head: [['User', 'Device', 'Checkout Date', 'Return Date', 'Status']],
        body: tableData,
        startY: 35,
        styles: { fontSize: 10 },
        headStyles: { fillColor: [66, 133, 244] },
        theme: 'grid'
      });
      
      doc.save('equipment_checkout_report.pdf');
    }

    function resetData() {
      if (confirm('Are you sure you want to reset to demo data?')) {
        // Reset to initial demo data
        checkoutHistory = [
          {
            id: 1,
            user: "Sarah Johnson",
            device: "MacBook Pro 16\"",
            checkoutDate: "Jul 25, 2025",
            returnDate: null,
            status: "Checked Out",
            notes: "For design team project"
          },
          {
            id: 2,
            user: "Michael Brown",
            device: "iPad Pro 12.9\"",
            checkoutDate: "Jul 24, 2025",
            returnDate: null,
            status: "Checked Out",
            notes: "Field research equipment"
          },
          {
            id: 3,
            user: "Emily Davis",
            device: "Samsung Galaxy Tab S8",
            checkoutDate: "Jul 23, 2025",
            returnDate: "Jul 28, 2025",
            status: "Returned",
            notes: "Marketing presentation"
          },
          {
            id: 4,
            user: "David Wilson",
            device: "Dell XPS 15 Laptop",
            checkoutDate: "Jul 20, 2025",
            returnDate: null,
            status: "Checked Out",
            notes: "Sales demo unit"
          },
          {
            id: 5,
            user: "Alex Thompson",
            device: "Logitech MX Master 3 Mouse",
            checkoutDate: "Jul 18, 2025",
            returnDate: "Jul 25, 2025",
            status: "Returned",
            notes: "Temporary replacement"
          }
        ];
        
        users = [
          "John Smith (IT Dept)", "Sarah Johnson (Design)", "Michael Brown (Engineering)", 
          "Emily Davis (Marketing)", "David Wilson (Sales)", "Alex Thompson (Support)",
          "Jessica Lee (HR)", "Robert Garcia (Operations)"
        ];
        
        devices = [
          "Dell XPS 15 Laptop", "MacBook Pro 16\"", "iPad Pro 12.9\"", "Samsung Galaxy Tab S8",
          "Logitech MX Master 3 Mouse", "Apple Magic Keyboard", "Wacom Intuos Pro", "Canon EOS R5 Camera",
          "Sony WH-1000XM5 Headphones", "Microsoft Surface Laptop 4", "Lenovo ThinkPad X1 Carbon",
          "Google Pixelbook Go", "Samsung Galaxy Book Pro", "HP Spectre x360"
        ];
        
        renderHistoryTable();
        alert('Demo data has been restored');
      }
    }

    // Initialize the application
    document.addEventListener('DOMContentLoaded', function() {
      // Set current date as default
      document.getElementById('checkoutDate').valueAsDate = new Date();
      
      // Set up event listeners
      checkoutBtn.addEventListener('click', checkoutEquipment);
      exportPdfBtn.addEventListener('click', exportToPDF);
      resetDataLink.addEventListener('click', resetData);
      
      // Auto-suggest functionality
      userInput.addEventListener('input', () => {
        showSuggestions(userInput, userSuggestions, users);
      });
      
      deviceInput.addEventListener('input', () => {
        showSuggestions(deviceInput, deviceSuggestions, devices);
      });
      
      // Close suggestions when clicking outside
      document.addEventListener('click', (e) => {
        if (!userInput.contains(e.target)) {
          userSuggestions.style.display = 'none';
        }
        if (!deviceInput.contains(e.target)) {
          deviceSuggestions.style.display = 'none';
        }
      });
      
      // Initialize UI
      renderHistoryTable();
      
      // Make functions available globally for onclick handlers
      window.returnItem = returnItem;
      window.deleteRecord = deleteRecord;
      window.editRecord = editRecord;
    });
  </script>
</body>
</html>
